<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Johanna Daas" />


<title>Optimization</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Dynamic Publication Media with CoRC</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="corc.html">About CoRC</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Code examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Beginners:</li>
    <li>
      <a href="optimization.html">Optimization</a>
    </li>
    <li class="dropdown-header">Advanced:</li>
    <li>
      <a href="parallel.html">Parallel Processing with CoRC</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Teaching
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="michaelis.html">Michaelis-Menten Kinetics</a>
    </li>
    <li>
      <a href="parameter.html">Parameter Estimation</a>
    </li>
    <li>
      <a href="oscillations.html">Oscillations</a>
    </li>
  </ul>
</li>
<li>
  <a href="infection.html">Infection dynamics</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://jpahle.github.io/CoRC/">CoRC</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Optimization</h1>
<h4 class="author">Johanna Daas</h4>

</div>


<p>This document follows closely the <a href="https://doi.org/10.1007/978-1-59745-525-1_2">Mendes 2009 paper</a><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> on <strong>COPASI</strong> use cases.</p>
<p>If we want to optimize something, we either want to <em>minimize</em> or <em>maximize</em> a specific task value.</p>
<div id="setup" class="section level1">
<h1>Setup</h1>
<p>First, we have to load <strong>CoRC</strong> and <strong>tidyverse</strong>. Make sure you have these packages downloaded.</p>
<pre class="r"><code>library(CoRC)
library(tidyverse)</code></pre>
</div>
<div id="loading-the-model" class="section level1">
<h1>Loading the model</h1>
<p>We will work with model <a href="https://www.ebi.ac.uk/biomodels/BIOMD0000000023">Nr. 23 in BioModels</a><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>, which is a simulation of analyzing sucrose accumulation in sugar cane (Rohwer 2001).</p>
<pre class="r"><code>loadSBML(&quot;https://www.ebi.ac.uk/biomodels/model/download/BIOMD0000000023?filename=BIOMD0000000023_url.xml&quot;)
#&gt; # A COPASI model reference:
#&gt; Model name: &quot;Rohwer2001_Sucrose&quot;
#&gt; Number of compartments: 1
#&gt; Number of species: 13
#&gt; Number of reactions: 11</code></pre>
<p>We will first take a look at the reactions:</p>
<pre class="r"><code>getReactions()
#&gt; # A tibble: 11 x 6
#&gt;    key   name  reaction      rate_law       flux number_flux
#&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt;
#&gt;  1 (v1)  v1    Fruex = Fru   FunctionDB.F~     0           0
#&gt;  2 (v2)  v2    Glcex = Glc   FunctionDB.F~     0           0
#&gt;  3 (v3)  v3    ATP + Glc = ~ FunctionDB.F~     0           0
#&gt;  4 (v4)  v4    Fru + ATP = ~ FunctionDB.F~     0           0
#&gt;  5 (v5)  v5    Fru + ATP = ~ FunctionDB.F~     0           0
#&gt;  6 (v6)  v6    2 * HexP = U~ FunctionDB.F~     0           0
#&gt;  7 (v7)  v7    Suc6P = Suc ~ FunctionDB.F~     0           0
#&gt;  8 (v8)  v8    HexP + Fru =~ FunctionDB.F~     0           0
#&gt;  9 (v9)  v9    Suc = Fru + ~ FunctionDB.F~     0           0
#&gt; 10 (v10) v10   HexP = glyco~ FunctionDB.F~     0           0
#&gt; 11 (v11) v11   Suc = Sucvac  FunctionDB.F~     0           0</code></pre>
<p>Of interest to us are reactions <em>v11</em> (accumulation of sucrose in vacuoles) and <em>v9</em> (hydrolysis of sucrose), which decreases our overall productivity.</p>
<p>We can see the behavior of these two species over time in this plot: <img src="optimization_files/figure-html/unnamed-chunk-5-1.png" width="100%" /></p>
</div>
<div id="the-objective-function" class="section level1">
<h1>The objective function</h1>
<p>We want to maximize our productivity, which we can define as the ratio of fluxes of accumulation over hydrolysis. $J_{v11}/J_{v9} $. For our optimization algorithms it is necessary to define our optimization goal as a minimum: we want to minimize <span class="math inline">\(J_{v9}/J_{v11}\)</span></p>
<p>What we just defined is called an <em>objective function</em>.</p>
<p>In <strong>CoRC</strong> we can define the objective function like this:</p>
<pre class="r"><code>objf &lt;- paste0(reaction(&quot;(v9)&quot;, reference = &quot;Flux&quot;), &quot;/&quot;, reaction(&quot;(v11)&quot;, reference = &quot;Flux&quot;))
getValue(objf)
#&gt; [1] 0.3122083</code></pre>
</div>
<div id="the-parameters" class="section level1">
<h1>The parameters</h1>
<p>Now we have to think about, what we are able to change to reach the minimum possible value for our objective function. We can assume for this teaching example that we are able to manipulate the steady state levels of our enzymes in reactions <em>v1</em>, <em>v2</em>, <em>v3</em>, <em>v4</em> and <em>v5</em>.</p>
<p>We have to tell <strong>CoRC</strong> about our optimization parameters like this: We could also specify our parameters more closely, e.g. give them a specific starting value or bounds on how far the estimation is allowed to search. We will say that we can downregulate an enzyme by 50% and overexpress it by 400%. The start values are supposed to be the current values in our model.</p>
<pre class="r"><code>make_opt_param &lt;- function(name) {
  value_ref &lt;- parameter_strict(name, reference = &quot;Value&quot;)
  value &lt;- getValue(value_ref)
  defineOptimizationParameter(ref = value_ref,
                              start_value = value,
                              lower_bound = 0.5 * value,
                              upper_bound = 4 * value)
}

parameters &lt;- lapply(c(&quot;(v1).Vmax1&quot;, &quot;(v2).Vmax2&quot;, &quot;(v3).Vmax3&quot;, &quot;(v4).Vmax4&quot;, &quot;(v5).Vmax5&quot;), make_opt_param)</code></pre>
</div>
<div id="optimization-method" class="section level1">
<h1>Optimization method</h1>
<p>Now we have to choose which optimization method we will use for optimization. For our first try we will use <em>Truncated Newton</em>. There are a lot of different methods available in <strong>CoRC</strong> which you can find in the documentation of the runOptimization() function.</p>
<pre class="r"><code>method &lt;- &#39;TruncatedNewton&#39;</code></pre>
</div>
<div id="optimization" class="section level1">
<h1>Optimization</h1>
<p>Now we have all elements we need for our optimization routine. We still need to specify a few arguments in our function: * subtask: Our subtask is optimization. We could also run a Steady State Analysis or a Scan with this function * randomize_start_values: We just took the time specifying where our start values are so we don’t want to randomize them all again. If we think we always find a local minimum instead of a global one, it might be helpful to randomize the start values. * update_model: We will save our current parameter values, so we can update the model in this function and not lose them.</p>
<pre class="r"><code>par_before &lt;- getParameters()$value

result &lt;- runOptimization(expression = objf,
                subtask = &#39;steadyState&#39;,
                randomize_start_values = FALSE,
                update_model = TRUE,
                parameters = parameters,
                method = method)
result$main$objective_value
#&gt; [1] 0.07816841
result$parameters
#&gt; # A tibble: 5 x 6
#&gt;   parameter lower_bound start_value  value upper_bound
#&gt;   &lt;chr&gt;           &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt;       &lt;dbl&gt;
#&gt; 1 (v1).Vma~      0.143       0.339  0.339        1.14 
#&gt; 2 (v2).Vma~      0.143       0.342  0.342        1.14 
#&gt; 3 (v3).Vma~      0.0985      0.0985 0.0985       0.788
#&gt; 4 (v4).Vma~      0.0985      0.196  0.196        0.788
#&gt; 5 (v5).Vma~      0.082       0.134  0.134        0.656
#&gt; # ... with 1 more variable: gradient &lt;dbl&gt;</code></pre>
<p>Our new model with the updated parameter values looks like this: <img src="optimization_files/figure-html/unnamed-chunk-10-1.png" width="100%" /> The dashed lines where from the timecourse before the optimization, so we can see that our optimization routine worked!</p>
<div id="references" class="section level2">
<h2>References</h2>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Mendes P., Hoops S., Sahle S., Gauges R., Dada J., Kummer U. (2009) Computational Modeling of Biochemical Networks Using COPASI. In: Maly I. (eds) Systems Biology. Methods in Molecular Biology (Methods and Protocols), vol 500. Humana Press. <a href="https://doi.org/10.1007/978-1-59745-525-1_2" class="uri">https://doi.org/10.1007/978-1-59745-525-1_2</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Rohwer, Johann M., and Frederik C. Botha. “Analysis of sucrose accumulation in the sugar cane culm on the basis of in vitro kinetic data.” Biochemical Journal 358.2 (2001): 437-445.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>

<p> Dynamic Publication Media with CoRC</p>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
